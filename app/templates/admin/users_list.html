<!-- app/templates/app/admin/users_list.html -->
{% extends 'app/base.html' %} {% block content %}
<div class="users-management">
  <div class="header-section">
    <h1>User Management</h1>
    <a href="{% url 'user_create' %}" class="btn btn-success"
      >+ Create New User</a
    >
  </div>

  {% if messages %} {% for message in messages %}
  <div class="alert alert-{{ message.tags }}">{{ message }}</div>
  {% endfor %} {% endif %}

  <!-- Search -->
  <div class="search-section">
    <form method="get" class="search-form">
      <input
        type="text"
        name="search"
        placeholder="Search users..."
        value="{{ search_query }}"
        class="search-input"
      />
      <button type="submit" class="btn btn-primary">Search</button>
      {% if search_query %}
      <a href="{% url 'users_list' %}" class="btn btn-secondary">Clear</a>
      {% endif %}
    </form>
  </div>

  <!-- Users Table -->
  <div class="table-container">
    <table class="users-table">
      <thead>
        <tr>
          <th>Username</th>
          <th>Email</th>
          <th>Name</th>
          <th>Role</th>
          <th>Joined</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for user in page_obj %}
        <tr>
          <td>{{ user.username }}</td>
          <td>{{ user.email|default:"—" }}</td>
          <td>{{ user.get_full_name|default:"—" }}</td>
          <td>
            <span class="role-badge role-{{ user.userprofile.role }}">
              {{ user.userprofile.role|title }}
            </span>
          </td>
          <td>{{ user.date_joined|date:"M j, Y" }}</td>
          <td class="actions">
            <a
              href="{% url 'user_edit' user.id %}"
              class="btn btn-sm btn-primary"
              >Edit</a
            >
            <a
              href="{% url 'user_permissions' user.id %}"
              class="btn btn-sm btn-info"
              >Permissions</a
            >
            <a
              href="{% url 'user_delete' user.id %}"
              class="btn btn-sm btn-danger"
              >Delete</a
            >
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="no-users">
            {% if search_query %} No users found matching "{{ search_query }}"
            {% else %} No users found {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  {% if page_obj.has_other_pages %}
  <div class="pagination">
    <span class="pagination-info">
      Showing {{ page_obj.start_index }} to {{ page_obj.end_index }} of {{
      page_obj.paginator.count }} users
    </span>
    <div class="pagination-links">
      {% if page_obj.has_previous %}
      <a
        href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}"
        class="btn btn-sm btn-outline"
        >First</a
      >
      <a
        href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}"
        class="btn btn-sm btn-outline"
        >Previous</a
      >
      {% endif %}

      <span class="current-page"
        >Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span
      >

      {% if page_obj.has_next %}
      <a
        href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}"
        class="btn btn-sm btn-outline"
        >Next</a
      >
      <a
        href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}"
        class="btn btn-sm btn-outline"
        >Last</a
      >
      {% endif %}
    </div>
  </div>
  {% endif %}

  <a href="{% url 'dashboard' %}" class="back-link">← Back to Dashboard</a>
</div>

<style>
  .users-management {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }

  .header-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
  }

  .header-section h1 {
    margin: 0;
    color: #333;
  }

  .search-section {
    margin-bottom: 20px;
  }

  .search-form {
    display: flex;
    gap: 10px;
    align-items: center;
  }

  .search-input {
    flex: 1;
    max-width: 300px;
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
  }

  .table-container {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    overflow: hidden;
  }

  .users-table {
    width: 100%;
    border-collapse: collapse;
  }

  .users-table th,
  .users-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #eee;
  }

  .users-table th {
    background: #f8f9fa;
    font-weight: 600;
    color: #495057;
  }

  .users-table tr:hover {
    background: #f8f9fa;
  }

  .role-badge {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 500;
  }

  .role-admin {
    background: #dc3545;
    color: white;
  }

  .role-staff {
    background: #ffc107;
    color: #333;
  }

  .role-viewer {
    background: #6c757d;
    color: white;
  }

  .actions {
    display: flex;
    gap: 5px;
  }

  .btn {
    padding: 6px 12px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    font-size: 14px;
    transition: background 0.2s;
  }

  .btn-sm {
    padding: 4px 8px;
    font-size: 12px;
  }

  .btn-primary {
    background: #007bff;
    color: white;
  }

  .btn-info {
    background: #17a2b8;
    color: white;
  }

  .btn-success {
    background: #28a745;
    color: white;
  }

  .btn-danger {
    background: #dc3545;
    color: white;
  }

  .btn-secondary {
    background: #6c757d;
    color: white;
  }

  .btn-outline {
    background: transparent;
    color: #007bff;
    border: 1px solid #007bff;
  }

  .btn:hover {
    opacity: 0.9;
  }

  .no-users {
    text-align: center;
    color: #666;
    font-style: italic;
  }

  .pagination {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 20px;
  }

  .pagination-info {
    color: #666;
    font-size: 14px;
  }

  .pagination-links {
    display: flex;
    gap: 5px;
    align-items: center;
  }

  .current-page {
    margin: 0 10px;
    font-weight: 500;
  }

  .alert {
    padding: 12px;
    border-radius: 4px;
    margin-bottom: 15px;
  }

  .alert-success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
  }

  .alert-error {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
  }

  .back-link {
    display: inline-block;
    margin-top: 20px;
    color: #007bff;
    text-decoration: none;
  }
</style>
{% endblock %}
