{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>KMDV CRM</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'app/css/base.css' %}"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'app/css/messages.css' %}"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'app/css/table_cont.css' %}"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'app/css/forms.css' %}"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'app/css/dashboard.css' %}"
    />
  </head>
  <body>
    <div class="container">
      <nav class="nav-with-logo">
        <a href="{% url 'dashboard' %}" class="logo">
          <img src="{% static 'app/img/logo_png.png' %}" alt="KMDV CRM Logo" />
        </a>
        {% if user.is_authenticated %}
        <a href="{% url 'dashboard' %}">Dashboard</a>
        <a href="{% url 'category_list' %}">Categories</a>
        <a href="{% url 'product_list' %}">Products</a>
        <a href="{% url 'vendor_list' %}">Vendors</a>
        <a href="{% url 'inventory_list' %}">Inventory</a>
        <a href="{% url 'order_list' %}">Orders</a>
        <a href="{% url 'profile' %}">Profile</a>
        <span class="user-welcome">Welcome, {{ user.username | title }}!</span>
        {% else %}
        <span class="user-welcome">Welcome, Guest!</span>
        {% endif %} {% if user.is_authenticated %}
        <form method="post" action="{% url 'logout' %}" style="display: inline">
          {% csrf_token %}
          <button type="submit" class="nav-a">Logout</button>
        </form>
        {% else %}
        <a href="{% url 'login' %}">Login</a>
        <a href="{% url 'register' %}">Register</a>
        {% endif %}
      </nav>
      <div class="content">{% block content %}{% endblock %}</div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const links = document.querySelectorAll("nav a[href]");
        const current = window.location.pathname;

        links.forEach((link) => {
          const base = link.getAttribute("href").split("/")[1]; // e.g. "inventory"
          link.classList.toggle("active", current.startsWith("/" + base + "/"));
        });
      });

      document.addEventListener("DOMContentLoaded", function () {
        // Handle all messages with dismiss classes
        const messages = document.querySelectorAll(".alert");

        messages.forEach(function (message) {
          let duration = 3000; // default 30 seconds

          // Check for dismiss-X classes
          const classes = message.className.split(" ");
          classes.forEach(function (cls) {
            if (cls.startsWith("dismiss-")) {
              duration = parseInt(cls.replace("dismiss-", "")) * 1000;
            }
          });

          // Auto-hide after duration
          setTimeout(function () {
            if (message.parentElement) {
              message.style.transition = "opacity 0.5s ease-out";
              message.style.opacity = "0";
              setTimeout(function () {
                if (message.parentElement) {
                  message.remove();
                }
              }, 500);
            }
          }, duration);
        });
      });
    </script>
  </body>
</html>
